#!/bin/bash
# Push å‰çš„æœ€åæ£€æŸ¥

set -e

echo "ğŸš€ å‡†å¤‡ pushï¼Œè¿è¡Œæœ€åæ£€æŸ¥..."

# 1. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
echo "ğŸ§ª è¿è¡Œå®Œæ•´æµ‹è¯•..."
cargo test --release || {
    echo "âŒ æµ‹è¯•å¤±è´¥"
    exit 1
}

# 2. æ£€æŸ¥æ˜¯å¦æœ‰æœªæäº¤çš„æ›´æ”¹
if ! git diff-index --quiet HEAD --; then
    echo "âš ï¸  è­¦å‘Š: æœ‰æœªæäº¤çš„æ›´æ”¹"
    git status --short
    read -p "ç¡®å®šè¦ push å—ï¼Ÿ(y/N) " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

# 3. è¿è¡Œç³»ç»Ÿæµ‹è¯•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
if [ -f "scripts/system_test.sh" ]; then
    echo "ğŸ”§ è¿è¡Œç³»ç»Ÿæµ‹è¯•..."
    bash scripts/system_test.sh || {
        echo "âŒ ç³»ç»Ÿæµ‹è¯•å¤±è´¥"
        exit 1
    }
fi

echo "âœ… å¯ä»¥å®‰å…¨ pushï¼"
